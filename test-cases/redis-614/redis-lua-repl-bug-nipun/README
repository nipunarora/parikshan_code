redis-lua-repl-bug
Redis Lua script, multi-element LPUSH / BRPOPLPUSH replication bug

Affected Redis Version: 2.5.12 (Redis 2.6.0 Release Candidate 6)

Update - Fixed Issue #614

@antirez reimplemented blocking operations in the 2.6 branch to fix this issue! See the commit message below for a detailed explanation.

https://github.com/antirez/redis/issues/614
https://github.com/antirez/redis/commit/f444e2afdc2394b647c7310b5b249616fcc5b43e
How to reproduce

Setup master/slave replication.
ruby consumer.rb
ruby producer.rb
Note how slave Redis receives wrong # of pop operations, and 'queue' continues to grow, out of sync with master Redis.
Producer

connects to Redis instance (in this case on localhost, db 8)
evals a Lua script that pushes multiple elements onto a list 'queue'
sleep 1 second
repeat
Consumer

connects to Redis instance
brpoplpush from 'queue' to processing queue.
remove from processing queue
repeat
